import{k as f,o as h,c,b as a,a as m,n as y,d as b,q as C,w,D,h as r,v as n,F as _,g as T,f as B,t as u}from"./index-41c00ed5.js";import{S as q,N as S,F}from"./Footer-9a29b948.js";import{a as g,S as A}from"./sweetalert2.all-10b92cf6.js";import{P as U,D as L}from"./jquery.dataTables-c2b1e719.js";import{Q as k}from"./quill.snow-286c7ad8.js";const M={id:"wrapper"},O={id:"content-wrapper",class:"d-flex flex-column"},V={id:"content"},j={class:"container-fluid my-4"},I={class:"row m-1"},H={class:"card p-3",style:{"border-radius":"25px"}},N=T('<div class="row mb-3"><div class="col-6"><div class="h5 font-weight-bold text-black">Blog</div></div><div class="d-flex justify-content-end col-6"><button class="btn btn-primary me-2" data-toggle="modal" data-target="#addData"><i class="bi bi-plus"></i> Tambah </button></div><div class="col-8"></div></div>',1),K={class:"table-responsive"},E={key:0,class:"preloader"},x=a("thead",null,[a("tr",null,[a("th",{scope:"col",style:{width:"50px"}},"No"),a("th",{scope:"col"},"Aksi"),a("th",{scope:"col"},"Foto"),a("th",{scope:"col"},"Header"),a("th",{scope:"col"},"Tanggal"),a("th",{scope:"col"},"Kategori"),a("th",{scope:"col"},"Isi")])],-1),z=["onClick"],P=a("i",{class:"bi bi-pencil-square"},null,-1),J=[P],Q=["onClick"],W=a("i",{class:"bi bi-trash3-fill"},null,-1),G=[W],R=["src"],X=["innerHTML"],Y={class:"modal fade",id:"addData",tabindex:"-1",role:"dialog","aria-labelledby":"addDataLabel","aria-hidden":"true"},Z={class:"modal-dialog",role:"document"},aa={class:"modal-content"},ta=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"addDataLabel"},"Tambah Data"),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[a("span",{"aria-hidden":"true"},"×")])],-1),ea={class:"modal-body"},oa={class:"form-group"},sa=a("label",{for:"foto"},"Foto",-1),da=a("p",{class:"text-danger"},"Keterangan: Ukuran foto maksimal 2 mb",-1),ia={class:"form-group"},la=a("label",{for:"header"},"Header",-1),ra={class:"form-group"},na=a("label",{for:"tanggal"},"Tanggal",-1),ha={class:"form-group"},pa=a("label",{for:"kategori"},"Kategori",-1),ca=a("div",{class:"form-group"},[a("label",{for:"isi"},"Isi"),a("div",{id:"isi_create_editor",style:{height:"200px"}})],-1),ua={class:"modal-footer"},ga=a("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1),ma={class:"modal fade",id:"dataUpdate",tabindex:"-1",role:"dialog","aria-labelledby":"dataUpdateLabel","aria-hidden":"true"},fa={class:"modal-dialog",role:"document"},ba={class:"modal-content"},_a=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"dataUpdateLabel"},"Update Data"),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[a("span",{"aria-hidden":"true"},"×")])],-1),ka={class:"modal-body"},Ua={class:"form-group"},va=a("label",{for:"foto"},"Foto",-1),ya=a("p",{class:"text-danger"},"Keterangan: Ukuran foto maksimal 2 mb",-1),Ca={class:"form-group"},wa=a("label",{for:"header"},"Header",-1),Da={class:"form-group"},Ta=a("label",{for:"tanggal"},"Tanggal",-1),$a={class:"form-group"},Ba=a("label",{for:"kategori"},"Kategori",-1),qa=a("div",{class:"form-group"},[a("label",{for:"isi"},"Isi"),a("div",{id:"isi_update_editor",style:{height:"200px"}})],-1),Sa={class:"modal-footer"},Fa=a("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1);U.use(L);const Aa={data(){return{dataList:[],tableOptions:{pagingType:"full_numbers"},dataCreate:{foto:null,header:"",tanggal:"",kategori:"",isi:""},dataUpdate:{id:"",foto:null,header:"",tanggal:"",kategori:"",isi:""},ready:!1}},mounted(){this.quillCreate=new k("#isi_create_editor",{theme:"snow",placeholder:"Masukkan isi",modules:{toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{align:[]}],["bold","italic","underline"],["link"],["blockquote","code-block"],[{color:[]},{background:[]}]]}}),this.quillCreate.on("text-change",()=>{this.dataCreate.isi=this.quillCreate.root.innerHTML}),this.quillUpdate=new k("#isi_update_editor",{theme:"snow",placeholder:"Masukkan isi",modules:{toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{align:[]}],["bold","italic","underline"],["link"],["blockquote","code-block"],[{color:[]},{background:[]}]]}}),this.quillUpdate.on("text-change",()=>{this.dataUpdate.isi=this.quillUpdate.root.innerHTML})},methods:{setDataUpdate(t,o,i,l,s,d){this.dataUpdate.id=t,this.dataUpdate.foto=o,this.dataUpdate.header=i,this.dataUpdate.tanggal=l,this.dataUpdate.kategori=s,this.dataUpdate.isi=d,this.quillUpdate.root.innerHTML=this.dataUpdate.isi},async sendUpdateData(){try{const t=new FormData;this.dataUpdate.foto instanceof File&&t.append("foto",this.dataUpdate.foto),t.append("header",this.dataUpdate.header),t.append("tanggal",this.dataUpdate.tanggal),t.append("kategori",this.dataUpdate.kategori),t.append("isi",this.dataUpdate.isi);const o=await g.post(`http://127.0.0.1:8000/api/blog/update/${this.dataUpdate.id}`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${sessionStorage.getItem("token")}`}});console.log(o.data),this.dataUpdate={id:"",foto:null,header:"",tanggal:"",kategori:"",isi:""},this.$refs.foto.value="",this.quillUpdate.setContents([]),this.fetchData(),this.showAlert("Berhasil!","Data berhasil diupdate.","success")}catch(t){if(console.error(t),t.response&&t.response.data&&t.response.data.errors){const o=t.response.data.errors;let i=`Terjadi kesalahan:
`;for(let l in o)o.hasOwnProperty(l)&&(i+=`${o[l].join(", ")}
`);this.showError("Opps...",i,"error")}else this.showError("Opps...","Terjadi kesalahan saat menambahkan data.","error")}},async tambahData(){try{const t=new FormData;t.append("foto",this.dataCreate.foto),t.append("header",this.dataCreate.header),t.append("tanggal",this.dataCreate.tanggal),t.append("kategori",this.dataCreate.kategori),t.append("isi",this.dataCreate.isi);const o=await g.post("http://127.0.0.1:8000/api/blog/create",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${sessionStorage.getItem("token")}`}});console.log(o.data),this.dataCreate={foto:null,header:"",tanggal:"",kategori:"",isi:""},this.$refs.foto.value="",this.quillCreate.setContents([]),this.fetchData(),this.showAlert("Berhasil!","Data berhasil ditambahkan.","success")}catch(t){if(console.error(t),t.response&&t.response.data&&t.response.data.errors){const o=t.response.data.errors;let i=`Terjadi kesalahan:
`;for(let l in o)o.hasOwnProperty(l)&&(i+=`${o[l].join(", ")}
`);this.showError("Opps...",i,"error")}else this.showError("Opps...","Terjadi kesalahan saat menambahkan data.","error")}},async fetchData(){this.ready=!1;try{const t=await g.get("http://127.0.0.1:8000/api/blog/list",{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});this.dataList=t.data.data,this.ready=!0}catch(t){console.error(t),this.showAlert("Opps...","Terjadi kesalahan saat mengambil data.","error")}},showAlert(t,o,i){this.$swal({title:t,text:o,icon:i}).then(()=>{$("#addData").modal("hide"),$("#dataUpdate").modal("hide")})},showError(t,o,i){this.$swal({title:t,text:o,icon:i}).then(()=>{})},async deleteData(t){try{const o=await g.delete(`http://127.0.0.1:8000/api/blog/delete/${t}`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});console.log(o.data),this.fetchData(),this.showAlert("Success","Data berhasil didelete","success")}catch(o){console.error(o),this.showAlert("Oops...","Terjadi kesalahan saat mendelete data","error")}},konfirmasi(t,o){A.fire({title:`Apakah Anda yakin ingin menghapus data ${o}?`,text:"Data akan dihapus jika anda menekan tombol Hapus.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ee0405",cancelButtonColor:"#858796",confirmButtonText:"Hapus",cancelButtonText:"Batal"}).then(i=>{i.isConfirmed&&this.deleteData(t)})},handleCreateFileUpload(t){this.dataCreate.foto=t.target.files[0]},handleUpdateFileUpload(t){this.dataUpdate.foto=t.target.files[0]},getImageUrl(t){return t!=null?`http://127.0.0.1:8000/storage/${t}`:"https://via.placeholder.com/150"}},created(){const t=sessionStorage.getItem("token");if(t)try{const[o,i]=t.split("."),l=JSON.parse(atob(o)),s=atob(i),e=JSON.parse(atob(t.split(".")[1])).exp,p=new Date(e*1e3);console.log("Waktu Kedaluwarsa (UTC):",p.toUTCString()),new Date>p?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/login")):console.log("Aman"),this.fetchData()}catch(o){console.error("Error decoding token:",o),this.$router.push("/login")}else this.$router.push("/login")}},Ia=Object.assign(Aa,{__name:"CrudBlogView",setup(t){const o=f(!1),i=f(""),l=()=>{o.value=!o.value,i.value=o.value?"toggled":""};return(s,d)=>(h(),c(_,null,[a("div",M,[m(q,{class:y(i.value)},null,8,["class"]),a("div",O,[a("div",V,[m(S,{onToggleSidebar:l}),a("div",j,[a("div",I,[a("div",H,[N,a("div",K,[s.ready?b("",!0):(h(),c("div",E)),s.ready?(h(),C(D(U),{key:1,class:"display table table-striped",options:s.tableOptions},{default:w(()=>[x,a("tbody",null,[(h(!0),c(_,null,B(s.dataList,(e,p)=>(h(),c("tr",{key:e.id},[a("td",null,u(p+1),1),a("td",null,[a("button",{class:"btn btn-warning me-1 mb-1","data-toggle":"modal","data-target":"#dataUpdate",onClick:v=>s.setDataUpdate(e.id,e.foto,e.header,e.tanggal,e.kategori,e.isi)},J,8,z),a("button",{class:"btn btn-danger me-1 mb-1",onClick:v=>s.konfirmasi(e.id,e.header)},G,8,Q)]),a("td",null,[a("img",{src:s.getImageUrl(e.foto),alt:"Foto Blog",class:"img-fluid",style:{width:"150px"}},null,8,R)]),a("td",null,u(e.header),1),a("td",null,u(e.tanggal),1),a("td",null,u(e.kategori),1),a("td",null,[a("div",{innerHTML:e.isi},null,8,X)])]))),128))])]),_:1},8,["options"])):b("",!0)])])])])]),m(F)])]),a("div",Y,[a("div",Z,[a("div",aa,[ta,a("div",ea,[a("form",null,[a("div",oa,[sa,a("input",{type:"file",class:"form-control",id:"foto",onChange:d[0]||(d[0]=(...e)=>s.handleCreateFileUpload&&s.handleCreateFileUpload(...e)),ref:"foto"},null,544),da]),a("div",ia,[la,r(a("input",{type:"text",class:"form-control",id:"header","onUpdate:modelValue":d[1]||(d[1]=e=>s.dataCreate.header=e),placeholder:"Masukkan header",required:""},null,512),[[n,s.dataCreate.header]])]),a("div",ra,[na,r(a("input",{type:"date",class:"form-control",id:"tanggal","onUpdate:modelValue":d[2]||(d[2]=e=>s.dataCreate.tanggal=e),placeholder:"Masukkan tanggal",required:""},null,512),[[n,s.dataCreate.tanggal]])]),a("div",ha,[pa,r(a("input",{type:"text",class:"form-control",id:"kategori","onUpdate:modelValue":d[3]||(d[3]=e=>s.dataCreate.kategori=e),placeholder:"Masukkan kategori",required:""},null,512),[[n,s.dataCreate.kategori]])]),ca])]),a("div",ua,[ga,a("button",{type:"button",class:"btn btn-primary",onClick:d[4]||(d[4]=(...e)=>s.tambahData&&s.tambahData(...e))}," Kirim ")])])])]),a("div",ma,[a("div",fa,[a("div",ba,[_a,a("div",ka,[a("form",null,[a("div",Ua,[va,a("input",{type:"file",class:"form-control",id:"foto",onChange:d[5]||(d[5]=(...e)=>s.handleUpdateFileUpload&&s.handleUpdateFileUpload(...e)),ref:"foto"},null,544),ya]),a("div",Ca,[wa,r(a("input",{type:"text",class:"form-control",id:"header","onUpdate:modelValue":d[6]||(d[6]=e=>s.dataUpdate.header=e),required:""},null,512),[[n,s.dataUpdate.header]])]),a("div",Da,[Ta,r(a("input",{type:"date",class:"form-control",id:"tanggal","onUpdate:modelValue":d[7]||(d[7]=e=>s.dataUpdate.tanggal=e),required:""},null,512),[[n,s.dataUpdate.tanggal]])]),a("div",$a,[Ba,r(a("input",{type:"text",class:"form-control",id:"kategori","onUpdate:modelValue":d[8]||(d[8]=e=>s.dataUpdate.kategori=e),required:""},null,512),[[n,s.dataUpdate.kategori]])]),qa])]),a("div",Sa,[Fa,a("button",{type:"button",class:"btn btn-danger",onClick:d[9]||(d[9]=(...e)=>s.sendUpdateData&&s.sendUpdateData(...e))}," Update ")])])])])],64))}});export{Ia as default};
